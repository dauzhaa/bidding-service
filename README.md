# üé® Art Bidding Microservices System

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–æ–≤ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏—Å–∫—É—Å—Å—Ç–≤–∞. –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –º—É–∑–µ—è (Metropolitan Museum of Art, NY) –¥–æ –ø—Ä–∏–µ–º–∞ —Å—Ç–∞–≤–æ–∫ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (Race Conditions) –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* **Microservices Architecture:** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ 4 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–µ—Ä–≤–∏—Å–∞ (Bidding, Auction, Notification, Gateway).
* **gRPC & Protobuf:** –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ.
* **Event-Driven Architecture:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ **Apache Kafka**.
* **External API Integration:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—É–±–ª–∏—á–Ω—ã–º API **The Met Museum**.
* **Highload Patterns:**
    * **Distributed Locking (Redis):** –ó–∞—â–∏—Ç–∞ –æ—Ç –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞–≤–∫–∞—Ö.
    * **Database Sharding:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –∫ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—é.
* **API Gateway:** –¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è REST (HTTP) -> gRPC —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π **Swagger**.
* **Quality Assurance:** Unit-—Ç–µ—Å—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Mocks (>84% –ø–æ–∫—Ä—ã—Ç–∏—è).

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

* **Language:** Go (Golang) 1.22+
* **Storage:** PostgreSQL (pgx driver), Redis
* **Message Broker:** Apache Kafka, Zookeeper
* **Communication:** gRPC, HTTP/1.1
* **Infrastructure:** Docker, Docker Compose
* **Tools:** Make, Mockery, Swagger (OpenAPI v2)

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

1.  **Gateway Service (Port 8081):**
    * –í—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (HTTP/JSON).
    * –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ gRPC —Å–µ—Ä–≤–∏—Å—ã.
2.  **Auction Service (Port 50052):**
    * –£–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ—Ç–∞–º–∏.
    * –•–æ–¥–∏—Ç –≤ API –º—É–∑–µ—è Met Museum, —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞—Ä—Ç–∏–Ω–∞—Ö.
    * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL (Shard 1).
3.  **Bidding Service (Port 50051):**
    * –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç–∞–≤–∫–∏.
    * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Redis Distributed Lock –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
    * –ü—Ä–æ–¥—é—Å–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è `bids.placed` –≤ Kafka.
4.  **Notification Service:**
    * –ö–æ–Ω—Å—å—é–º–µ—Ä Kafka.
    * –ß–∏—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –æ —Å—Ç–∞–≤–∫–∞—Ö –∏ –∏–º–∏—Ç–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

---

## üèÅ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –±—Ä–æ–∫–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö:

```bash
docker-compose up -d

2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ PostgreSQL (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑):
Bash

# –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∞—É–∫—Ü–∏–æ–Ω–æ–≤
sudo docker exec -i goproject-postgres-shard-1-1 psql -U user -d auction_db_1 -c "CREATE TABLE IF NOT EXISTS auctions (id BIGINT PRIMARY KEY, title TEXT, artist TEXT, start_price BIGINT, image_url TEXT, status TEXT);"

# –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Å—Ç–∞–≤–æ–∫ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
sudo docker exec -i goproject-postgres-shard-1-1 psql -U user -d auction_db_1 -c "CREATE TABLE IF NOT EXISTS bids (id SERIAL PRIMARY KEY, auction_id BIGINT, user_id BIGINT, amount BIGINT, created_at TIMESTAMP);"

3. –ó–∞–ø—É—Å–∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –ª–æ–≥–∏.

–¢–µ—Ä–º–∏–Ω–∞–ª 1 (–°–µ—Ä–≤–∏—Å —Å—Ç–∞–≤–æ–∫):
Bash

make run-bidding

–¢–µ—Ä–º–∏–Ω–∞–ª 2 (–°–µ—Ä–≤–∏—Å –∞—É–∫—Ü–∏–æ–Ω–æ–≤):
Bash

make run-auction

–¢–µ—Ä–º–∏–Ω–∞–ª 3 (–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π):
Bash

make run-notification

–¢–µ—Ä–º–∏–Ω–∞–ª 4 (API Gateway):
Bash

make run-gateway

üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API (Demo)
1. –°–æ–∑–¥–∞–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞

–°–æ–∑–¥–∞–¥–∏–º –ª–æ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—Ä—Ç–∏–Ω—ã –ö–ª–æ–¥–∞ –ú–æ–Ω–µ "–ë—É–∫–µ—Ç –ø–æ–¥—Å–æ–ª–Ω—É—Ö–æ–≤" (ID –º—É–∑–µ—è: 436121):
Bash

curl -X POST http://localhost:8081/v1/auctions \
  -d '{"object_id": 436121, "start_price": 5000}'

–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: JSON —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∫–∞—Ä—Ç–∏–Ω—ã, –∏–º–µ–Ω–µ–º —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –∏ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
2. –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏

–°–¥–µ–ª–∞–µ–º —Å—Ç–∞–≤–∫—É –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ª–æ—Ç:
Bash

curl -X POST http://localhost:8081/v1/bids \
  -d '{"auction_id": 436121, "user_id": 1, "amount": 6000}'

–†–µ–∑—É–ª—å—Ç–∞—Ç:

    Gateway –≤–µ—Ä–Ω–µ—Ç —É—Å–ø–µ—à–Ω—ã–π —Å—Ç–∞—Ç—É—Å.

    Bidding Service –∑–∞–ø–∏—à–µ—Ç —Å—Ç–∞–≤–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Kafka.

    Notification Service (–≤ 3-–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ) –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤—ã–≤–µ–¥–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å—Ç–∞–≤–∫–µ.

üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ Swagger UI

–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è API –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ .proto —Ñ–∞–π–ª–æ–≤. –ß—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:

    –ó–∞–π–¥–∏—Ç–µ –Ω–∞ Swagger Editor.

    –ù–∞–∂–º–∏—Ç–µ File -> Import File.

    –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª api/swagger/auction_service.json –∏–ª–∏ bidding_service.json –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.

    –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞.

‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

–ü—Ä–æ–µ–∫—Ç –ø–æ–∫—Ä—ã—Ç Unit-—Ç–µ—Å—Ç–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–æ–∫–æ–≤ (Mockery).
Bash

go test ./internal/services/bidding_service/... -v -cover